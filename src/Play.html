<div class="row">
    <table class="twelve columns">
        <thead>
            <tr>
                <th>Round #</th>
                {{#each $players as player, i}}
                <th>{{ player }}</th>
                {{/each}}
                <th>Discard</th>
            </tr>
        </thead>
        <tbody>
            {{#each $rounds as round, i}}
            <tr>
                <td>
                    {{ i+1 }} 
                </td>
                {{#each $players as player}}
                <td>
                    <input type="number" value="{{ round[player] }}" on:input="updateScore(event, player, i)">
                </td>
                {{/each}}

                <td>
                    <button class="x-round button" on:click="removeRound(i)">x</button>
                </td>
            </tr>
            {{/each}}

            <tr class="totals">
                <td>Totals:</td>
                {{#each $players as player}}
                <td>{{ totals[player] || 0 }}</td>
                {{/each}}
                <td></td>
            </tr>
        </tbody>
    </table>

    <div>
        <button class="button button-primary" on:click="nextRound()">Next round</button>
        <button class="button" on:click="store.set({ started: false })">Change players</button>
    </div>
</div>

<style>
button.x-round {

}
</style>

<script>
import { totals } from './helpers.js';

export default {

    oncreate() {
        const rounds = this.store.get('rounds');

        if (rounds.length < 1) {
            this.nextRound();
        }
    },

    computed: {
        totals: ($rounds) => totals($rounds)
    },

    methods: {
        nextRound() {

            const {rounds, players} = this.store.get();

            const round = players.reduce((m, p) => {
                m[p] = 0;
                return m;
            }, {});

            rounds.push(round);

            this.store.set({ rounds });
        },

        removeRound(index) {
            const rounds = this.store.get('rounds')
                .filter((r, i) => i !== index);

            this.store.set({ rounds });
        },

        updateScore(e, player, index) {

            const rounds = this.store.get('rounds');
            const value = +e.target.value;

            const updated = rounds.map((round, i) => {

                if (i === index) {
                    round[player] = value;
                }

                return round;
            });

            this.store.set({ rounds: updated });
        }
    }
}
</script>